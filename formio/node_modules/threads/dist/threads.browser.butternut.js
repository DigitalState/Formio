require=(function e(n,t,r){function o(i,c){if(!t[i]){if(!n[i]){var s=typeof require=="function"&&require;if(!c&&s)return s(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var l=t[i]={exports:{}};n[i][0].call(l.exports,function(e){var t=n[i][1][e];return o(t?t:e)},l,l.exports,e,n,t,r)}return t[i].exports}var u=typeof require=="function"&&require;for(var i=0;i<r.length;i++)o(r[i]);return o})({"./defaults":[function(e,n,t){"use strict";t.__esModule=!0;t.default={pool:{size:navigator.hardwareConcurrency||8}}},{}],"./worker":[function(e,n,t){"use strict";t.__esModule=!0;var r=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=e('eventemitter3'),u=a(o),i=e('./slave-code-uri'),c=a(i),s=e('../config');function a(e){return e&&e.__esModule?e:{default:e}}function l(e,n){if(!(e instanceof n)){throw new TypeError("Cannot call a class as a function")}}function f(e,n){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n&&(typeof n==="object"||typeof n==="function")?n:e}function p(e,n){if(typeof n!=="function"&&n!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof n)}e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}});n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}if(r(window.Worker)!=='object'&&typeof window.Worker!=='function'){throw new Error('Browser does not support web workers!')}function d(e,n){if(!e||!n){return e+n}else if(e.charAt(e.length-1)==='/'||n.charAt(0)==='/'){return e+n}else{return e+'/'+n}}function h(e){var n=(0, s.getConfig)().basepath.web;return n?d(n,e):e}function g(e){return Array.prototype.slice.call(e)}function y(e){if(e.stack)console.error(e.stack);else if(e.message&&e.filename&&e.lineno){var n=e.filename.match(/^data:text\/javascript/)&&e.filename.length>50?e.filename.substr(0,50)+'...':e.filename;console.error(e.message+' @'+n+':'+e.lineno)}else console.error(e)}var m=function(e){p(n,e);function n(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];l(this,n);var o=f(this,e.call(this));o.currentRunnable=null;o.currentImportScripts=[];o.initWorker();o.worker.addEventListener('message',o.handleMessage.bind(o));o.worker.addEventListener('error',o.handleError.bind(o));t&&o.run(t,r);return o}n.prototype.initWorker=function(){try{this.worker=new window.Worker(c.default)}catch(n){var e=(0, s.getConfig)().fallback.slaveScriptUrl;if(e)this.worker=new window.Worker(e);else{throw n}}};n.prototype.run=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];if(this.alreadyInitializedToRun(e,n)){return this}typeof e==='function'?this.runMethod(e,n):this.runScripts(e,n);this.currentRunnable=e;this.currentImportScripts=n;return this};n.prototype.runMethod=function(e,n){var t=e.toString(),r=t.substring(t.indexOf('(')+1,t.indexOf(')')).split(','),o=t.substring(t.indexOf('{')+1,t.lastIndexOf('}'));this.worker.postMessage({initByMethod:!0,method:{args:r,body:o},scripts:n.map(h)})};n.prototype.runScripts=function(e,n){if(!e){throw new Error('Must pass a function or a script URL to run().')}this.worker.postMessage({initByScripts:!0,scripts:n.concat([e]).map(h)})};n.prototype.send=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.worker.postMessage({doRun:!0,param:e},n);return this};n.prototype.kill=function(){this.worker.terminate();this.emit('exit');return this};n.prototype.promise=function(){var e=this;return new Promise(function(n,t){var r=void 0,o=void 0;r=function(t){e.removeListener('error',o);n(t)};o=function(n){e.removeListener('message',r);t(n)};e.once('message',r).once('error',o)})};n.prototype.alreadyInitializedToRun=function(e,n){var t=this.currentRunnable===e,r=this.currentImportScripts===n||n.length===0&&this.currentImportScripts.length===0;return t&&r};n.prototype.handleMessage=function(e){if(e.data.error)this.handleError(e.data.error);else if(e.data.progress)this.handleProgress(e.data.progress);else{var n=g(e.data.response);this.emit.apply(this,['message'].concat(n));this.emit.apply(this,['done'].concat(n))}};n.prototype.handleProgress=function(e){this.emit('progress',e)};n.prototype.handleError=function(e){this.listeners('error',!0)||y(e);e.preventDefault&&e.preventDefault();this.emit('error',e)};return n}(u.default);t.default=m},{"../config":2,"./slave-code-uri":6,"eventemitter3":8}],1:[function(e,n,t){"use strict";var r=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=e('./index'),u=i(o);function i(e){return e&&e.__esModule?e:{default:e}}(typeof window==='undefined'?'undefined':r(window))==='object'&&(window.thread=u.default);typeof define==='function'?define([],function(){return u.default}):(typeof n==='undefined'?'undefined':r(n))==='object'&&(n.exports=u.default)},{"./index":3}],2:[function(e,n,t){"use strict";t.__esModule=!0;var r=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.getConfig=c;t.setConfig=s;var o={basepath:{node:'',web:''},fallback:{slaveScriptUrl:''}};function u(e,n){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];Object.keys(n).forEach(function(o){var i=n[o],c=t.concat([o]);if((typeof i==='undefined'?'undefined':r(i))==='object'){if(typeof e[o]!=='undefined'&&r(e[o])!=='object'){throw new Error('Expected config property not to be an object: '+c.join('.'))}u(e[o],i,c)}else{if(r(e[o])==='object'){throw new Error('Expected config property to be an object: '+c.join('.'))}e[o]=i}})}var i={get:function(){return o},set:function(e){if((typeof e==='undefined'?'undefined':r(e))!=='object'){throw new Error('Expected config object.')}u(o,e)}};t.default=i;function c(){return i.get()}function s(){return i.set.apply(i,arguments)}},{}],3:[function(e,n,t){"use strict";t.__esModule=!0;t.Pool=t.defaults=t.config=void 0;t.spawn=p;e('native-promise-only');var r=e('./config'),o=f(r),u=e('./defaults'),i=f(u),c=e('./pool'),s=f(c),a=e('./worker'),l=f(a);function f(e){return e&&e.__esModule?e:{default:e}}t.config=o.default;t.defaults=i.default;t.Pool=s.default;function p(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return new l.default(e,n)}t.default={config:o.default,defaults:i.default,Pool:s.default,spawn:p,Worker:l.default}},{"./config":2,"./defaults":"./defaults","./pool":5,"./worker":"./worker","native-promise-only":9}],4:[function(e,n,t){"use strict";t.__esModule=!0;var r=e('eventemitter3'),o=u(r);function u(e){return e&&e.__esModule?e:{default:e}}function i(e,n){if(!(e instanceof n)){throw new TypeError("Cannot call a class as a function")}}function c(e,n){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n&&(typeof n==="object"||typeof n==="function")?n:e}function s(e,n){if(typeof n!=="function"&&n!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof n)}e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}});n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}var a=function(e){s(n,e);function n(t){i(this,n);var r=c(this,e.call(this));r.pool=t;r.thread=null;r.runArgs=[];r.sendArgs=[];t.emit('newJob',r);return r}n.prototype.run=function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];if(n.length===0){throw new Error('Cannot call .run() without arguments.')}this.runArgs=n;return this};n.prototype.send=function(){if(this.runArgs.length===0){throw new Error('Cannot .send() before .run().')}for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];this.sendArgs=n;this.emit('readyToRun');return this};n.prototype.executeOn=function(e){var n,t;(n=(t=e.once('message',this.emit.bind(this,'done')).once('error',this.emit.bind(this,'error'))).run.apply(t,this.runArgs)).send.apply(n,this.sendArgs);this.thread=e;this.emit('threadChanged');return this};n.prototype.promise=function(){var e=this;return new Promise(function(n){e.thread?n(e.thread.promise()):e.once('threadChanged',function(){n(e.thread.promise())})})};n.prototype.destroy=function(){this.removeAllListeners();delete this.runArgs;delete this.sendArgs};return n}(o.default);t.default=a},{"eventemitter3":8}],5:[function(e,n,t){"use strict";t.__esModule=!0;var r=e('eventemitter3'),o=l(r),u=e('./job'),i=l(u),c=e('./defaults'),s=l(c),a=e('./');function l(e){return e&&e.__esModule?e:{default:e}}function f(e,n){if(!(e instanceof n)){throw new TypeError("Cannot call a class as a function")}}function p(e,n){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n&&(typeof n==="object"||typeof n==="function")?n:e}function d(e,n){if(typeof n!=="function"&&n!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof n)}e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}});n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}var h=function(e){d(n,e);function n(t){f(this,n);var r=p(this,e.call(this));r.threads=n.spawn(t||s.default.pool.size);r.idleThreads=r.threads.slice();r.jobQueue=[];r.runArgs=[];r.on('newJob',function(e){return r.handleNewJob(e)});r.on('threadAvailable',function(){return r.dequeue()});return r}n.prototype.run=function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];this.runArgs=n;return this};n.prototype.send=function(){var e;if(!this.runArgs){throw new Error('Pool.send() called without prior Pool.run(). You need to define what to run first.')}var n=new i.default(this);return(e=n.run.apply(n,this.runArgs)).send.apply(e,arguments)};n.prototype.killAll=function(){this.threads.forEach(function(e){e.kill()})};n.prototype.queueJob=function(e){this.jobQueue.push(e);this.dequeue()};n.prototype.dequeue=function(){var e=this;if(this.jobQueue.length===0||this.idleThreads.length===0){return}var n=this.jobQueue.shift(),t=this.idleThreads.shift();n.once('done',function(){for(var r=arguments.length,o=Array(r),u=0;u<r;u++)o[u]=arguments[u];return e.handleJobSuccess.apply(e,[t,n].concat(o))}).once('error',function(){for(var r=arguments.length,o=Array(r),u=0;u<r;u++)o[u]=arguments[u];return e.handleJobError.apply(e,[t,n].concat(o))});n.executeOn(t)};n.prototype.handleNewJob=function(e){var n=this;e.once('readyToRun',function(){return n.queueJob(e)})};n.prototype.handleJobSuccess=function(e,n){for(var t=arguments.length,r=Array(t>2?t-2:0),o=2;o<t;o++)r[o-2]=arguments[o];this.emit.apply(this,['done',n].concat(r));this.handleJobDone(e,n)};n.prototype.handleJobError=function(e,n,t){this.emit('error',n,t);this.handleJobDone(e,n)};n.prototype.handleJobDone=function(e,n){var t=this;n.destroy();this.idleThreads.push(e);this.emit('threadAvailable');this.idleThreads.length===this.threads.length&&setTimeout(function(){t.emit('finished')},0)};return n}(o.default);t.default=h;h.spawn=function(e){var n=[];for(var t=0;t<e;t++)n.push((0, a.spawn)());return n}},{"./":3,"./defaults":"./defaults","./job":4,"eventemitter3":8}],6:[function(e,n,t){"use strict";t.__esModule=!0;var r=e('./slave-code'),o=u(r);function u(e){return e&&e.__esModule?e:{default:e}}var i='data:text/javascript;charset=utf-8,'+encodeURI(o.default),c=window.createBlobURL||window.createObjectURL;if(!c){var s=window.URL||window.webkitURL;if(s)c=s.createObjectURL;else{throw new Error('No Blob creation implementation found.')}}if(typeof window.BlobBuilder==='function'&&typeof c==='function'){var a=new window.BlobBuilder;a.append(o.default);i=c(a.getBlob())}else if(typeof window.Blob==='function'&&typeof c==='function'){var l=new window.Blob([o.default],{type:'text/javascript'});i=c(l)}t.default=i},{"./slave-code":7}],7:[function(e,n,t){n.exports="/*eslint-env worker*/\n/*global importScripts*/\n/*eslint-disable no-console*/\nself.module = {\n  exports : function() {\n    if (console) { console.error('No thread logic initialized.'); }\n  }\n};\n\nfunction handlerDone() {\n  var args = Array.prototype.slice.call(arguments, 0);\n  this.postMessage({ response : args });\n}\n\nfunction handlerProgress(progress) {\n  this.postMessage({ progress : progress });\n}\n\nfunction handlerDoneTransfer() {\n  var args = Array.prototype.slice.call(arguments);\n  var lastArg = args.pop();\n\n  if (!(lastArg instanceof Array) && this.console) {\n    console.error('Expected 2nd parameter of <doneCallback>.transfer() to be an array. Got:', lastArg);\n  }\n\n  this.postMessage({ response : args }, lastArg);\n}\n\nself.onmessage = function (event) {\n  var scripts = event.data.scripts;\n  if (scripts && scripts.length > 0 && typeof importScripts !== 'function') {\n    throw new Error('importScripts() not supported.');\n  }\n\n  if (event.data.initByScripts) {\n    importScripts.apply(null, scripts);\n  }\n\n  if (event.data.initByMethod) {\n    var method = event.data.method;\n    this.module.exports = Function.apply(null, method.args.concat(method.body));\n\n    if (scripts && scripts.length > 0) {\n      importScripts.apply(null, scripts);\n    }\n  }\n\n  if (event.data.doRun) {\n    var handler = this.module.exports;\n    if (typeof handler !== 'function') {\n      throw new Error('Cannot run thread logic. No handler has been exported.');\n    }\n\n    var preparedHandlerDone = handlerDone.bind(this);\n    preparedHandlerDone.transfer = handlerDoneTransfer.bind(this);\n\n    handler.call(this, event.data.param, preparedHandlerDone, handlerProgress.bind(this));\n  }\n}.bind(self);\n"},{}],8:[function(e,n,t){"use strict";var r=Object.prototype.hasOwnProperty,o='~';function u(){}Object.create&&(u.prototype=Object.create(null),new u.__proto__||(o=!1));function i(e,n,t){this.fn=e;this.context=n;this.once=t||!1}function c(){this._events=new u;this._eventsCount=0}c.prototype.eventNames=function(){var e=[],n,t;if(this._eventsCount===0)return e;for(t in n=this._events)r.call(n,t)&&e.push(o?t.slice(1):t);if(Object.getOwnPropertySymbols){return e.concat(Object.getOwnPropertySymbols(n))}return e};c.prototype.listeners=function(e,n){var t=o?o+e:e,r=this._events[t];if(n)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var u=0,i=r.length,c=new Array(i);u<i;u++)c[u]=r[u].fn;return c};c.prototype.emit=function(e,n,t,r,u,i){var c=o?o+e:e;if(!this._events[c])return!1;var s=this._events[c],a=arguments.length,l,f;if(s.fn){s.once&&this.removeListener(e,s.fn,void 0,!0);switch(a){case 1:return s.fn.call(s.context), !0;case 2:return s.fn.call(s.context,n), !0;case 3:return s.fn.call(s.context,n,t), !0;case 4:return s.fn.call(s.context,n,t,r), !0;case 5:return s.fn.call(s.context,n,t,r,u), !0;case 6:return s.fn.call(s.context,n,t,r,u,i), !0}for(f=1, l=new Array(a-1);f<a;f++)l[f-1]=arguments[f];s.fn.apply(s.context,l)}else{var p=s.length,d;for(f=0;f<p;f++){s[f].once&&this.removeListener(e,s[f].fn,void 0,!0);switch(a){case 1:s[f].fn.call(s[f].context);break;case 2:s[f].fn.call(s[f].context,n);break;case 3:s[f].fn.call(s[f].context,n,t);break;case 4:s[f].fn.call(s[f].context,n,t,r);break;default:if(!l)for(d=1, l=new Array(a-1);d<a;d++)l[d-1]=arguments[d];s[f].fn.apply(s[f].context,l)}}}return!0};c.prototype.on=function(e,n,t){var r=new i(n,t||this),u=o?o+e:e;this._events[u]?this._events[u].fn?(this._events[u]=[this._events[u],r]):this._events[u].push(r):(this._events[u]=r, this._eventsCount++);return this};c.prototype.once=function(e,n,t){var r=new i(n,t||this,!0),u=o?o+e:e;this._events[u]?this._events[u].fn?(this._events[u]=[this._events[u],r]):this._events[u].push(r):(this._events[u]=r, this._eventsCount++);return this};c.prototype.removeListener=function(e,n,t,r){var i=o?o+e:e;if(!this._events[i])return this;if(!n){--this._eventsCount===0?(this._events=new u):delete this._events[i];return this}var c=this._events[i];if(c.fn)c.fn===n&&(!r||c.once)&&(!t||c.context===t)&&(--this._eventsCount===0?(this._events=new u):delete this._events[i]);else{for(var s=0,a=[],l=c.length;s<l;s++)(c[s].fn!==n||r&&!c[s].once||t&&c[s].context!==t)&&a.push(c[s]);a.length?(this._events[i]=a.length===1?a[0]:a):--this._eventsCount===0?(this._events=new u):delete this._events[i]}return this};c.prototype.removeAllListeners=function(e){var n;e?(n=o?o+e:e,this._events[n]&&(--this._eventsCount===0?(this._events=new u):delete this._events[n])):(this._events=new u,this._eventsCount=0);return this};c.prototype.off=c.prototype.removeListener;c.prototype.addListener=c.prototype.on;c.prototype.setMaxListeners=function(){return this};c.prefixed=o;c.EventEmitter=c;'undefined'!==typeof n&&(n.exports=c)},{}],9:[function(e,n,t){(function(e){!function(e,t,r){t[e]=t[e]||r();typeof n!="undefined"&&n.exports?(n.exports=t[e]):typeof define=="function"&&define.amd&&define(function(){return t[e]})}("Promise",typeof e!="undefined"?e:this,function(){"use strict";var e,n,t,r=Object.prototype.toString,o=typeof setImmediate!="undefined"?function(e){return setImmediate(e)}:setTimeout;try{Object.defineProperty({},"x",{}),e=function(e,n,t,r){return Object.defineProperty(e,n,{value:t,writable:!0,configurable:r!==!1})}}catch(n){e=function(e,n,t){e[n]=t;return e}};t=(function(){var e,t,r;function o(e,n){this.fn=e;this.self=n;this.next=void 0}return{add:function(n,u){r=new o(n,u);t?(t.next=r):(e=r);t=r;r=void 0},drain:function(){var r=e;e=t=n=void 0;while(r)r.fn.call(r.self),r=r.next}}})();function u(e,r){t.add(e,r);n||(n=o(t.drain))}function i(e){var n,t=typeof e;e!=null&&(t=="object"||t=="function")&&(n=e.then);return typeof n=="function"?n:!1}function c(){for(var e=0;e<this.chain.length;e++)s(this,this.state===1?this.chain[e].success:this.chain[e].failure,this.chain[e]);this.chain.length=0}function s(e,n,t){var r,o;try{n===!1?t.reject(e.msg):(n===!0?(r=e.msg):(r=n.call(void 0,e.msg)),r===t.promise?t.reject(TypeError("Promise-chain cycle")):(o=i(r))?o.call(r,t.resolve,t.reject):t.resolve(r))}catch(e){t.reject(e)}}function a(e){var n,t=this;if(t.triggered){return}t.triggered=!0;t.def&&(t=t.def);try{(n=i(e))?u(function(){var r=new p(t);try{n.call(e,function(){a.apply(r,arguments)},function(){l.apply(r,arguments)})}catch(e){l.call(r,e)}}):(t.msg=e,t.state=1,t.chain.length>0&&u(c,t))}catch(e){l.call(new p(t),e)}}function l(e){var n=this;if(n.triggered){return}n.triggered=!0;n.def&&(n=n.def);n.msg=e;n.state=2;n.chain.length>0&&u(c,n)}function f(e,n,t,r){for(var o=0;o<n.length;o++)!function(o){e.resolve(n[o]).then(function(e){t(o,e)},r)}(o)}function p(e){this.def=e;this.triggered=!1}function d(e){this.promise=e;this.state=0;this.triggered=!1;this.chain=[];this.msg=void 0}function h(e){if(typeof e!="function"){throw TypeError("Not a function")}if(this.__NPO__!==0){throw TypeError("Not a promise")}this.__NPO__=1;var n=new d(this);this.then=function(e,t){var r={success:typeof e=="function"?e:!0,failure:typeof t=="function"?t:!1};r.promise=new this.constructor(function(e,n){if(typeof e!="function"||typeof n!="function"){throw TypeError("Not a function")}r.resolve=e;r.reject=n});n.chain.push(r);n.state!==0&&u(c,n);return r.promise};this["catch"]=function(e){return this.then(void 0,e)};try{e.call(void 0,function(e){a.call(n,e)},function(e){l.call(n,e)})}catch(e){l.call(n,e)}}var g=e({},"constructor",h,!1);h.prototype=g;e(g,"__NPO__",0,!1);e(h,"resolve",function(e){var n=this;if(e&&typeof e=="object"&&e.__NPO__===1){return e}return new n(function(n,t){if(typeof n!="function"||typeof t!="function"){throw TypeError("Not a function")}n(e)})});e(h,"reject",function(e){return new this(function(n,t){if(typeof n!="function"||typeof t!="function"){throw TypeError("Not a function")}t(e)})});e(h,"all",function(e){var n=this;if(r.call(e)!="[object Array]"){return n.reject(TypeError("Not an array"))}if(e.length===0){return n.resolve([])}return new n(function(t,r){if(typeof t!="function"||typeof r!="function"){throw TypeError("Not a function")}var o=e.length,u=Array(o),i=0;f(n,e,function(e,n){u[e]=n;++i===o&&t(u)},r)})});e(h,"race",function(e){var n=this;if(r.call(e)!="[object Array]"){return n.reject(TypeError("Not an array"))}return new n(function(t,r){if(typeof t!="function"||typeof r!="function"){throw TypeError("Not a function")}f(n,e,function(e,n){t(n)},r)})});return h})}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}]},{},[1])
